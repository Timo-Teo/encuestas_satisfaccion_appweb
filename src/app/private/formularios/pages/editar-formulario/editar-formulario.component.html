<div *ngIf="formularioEstructura">
  <h3>Ficha de formulario</h3>
  <div>
    <p><b>Nombre: </b>{{ formularioEstructura.nombre }}</p>
    <p><b>Periodo: </b>{{ formularioEstructura.periodo.nombre }}</p>
    <p><b>Dependencia evaluada: </b>{{ formularioEstructura.dependencia.nombre }}</p>
    <p><b>Vigente : </b>
      <p-tag [value]="formularioEstructura.vigente ? 'ACTIVO' : 'INACTIVO'"
             [severity]="getSeverity(formularioEstructura.vigente)"/>
    </p>
  </div>
  <p-tabView>
    <p-tabPanel header="General">
      <div>
        <h4>Parámetros generales</h4>
        <div class="card flex justify-content-center">
          <p-inputSwitch
            (onChange)="onHabilitarEdicion($event)"
          />
        </div>
        <form [formGroup]="formularioEstructuraForm">
          <p-floatLabel>
            <input
              formControlName="nombre"
              pInputText
              id="nombre"
              [ngClass]="{
            'ng-dirty ng-invalid':  nombre?.invalid || nombre?.dirty,
            }"
            />
            <label for="nombre">Nombre</label>
          </p-floatLabel>
          <p-floatLabel>
            <p-dropdown
              formControlName="periodo"
              inputId="periodo"
              id="periodo"
              [options]="periodos"
              optionLabel="nombre"
              optionValue="id"
            />
            <label for="periodo">Periodos</label>
          </p-floatLabel>

          <p-floatLabel>
            <p-dropdown
              formControlName="dependencia"
              inputId="dependencias"
              id="dependencias"
              filterBy="nombre"
              [filter]="true"
              [options]="dependencias"
              optionLabel="nombre"
              optionValue="id"
            />
            <label for="dependencias">Dependencia evaluada</label>
          </p-floatLabel>
          <p-floatLabel>
            <p-dropdown
              formControlName="vigencia"
              inputId="vigencia"
              id="vigencia"
              [options]="vigencias"
              placeholder="Vigencia">
            </p-dropdown>
            <label for="vigencia">Vigencia</label>
          </p-floatLabel>
        </form>
        <p-button
          label="Guardar cambios"
          icon="pi pi-save"
          (click)="onGuardarFormulario()"
          [disabled]="formularioEstructuraForm.invalid || formularioEstructuraForm.disabled"
        ></p-button>
      </div>
    </p-tabPanel>
    <p-tabPanel header="Diseño">
      <div>
        <div class="card">
          <p-toast/>
          <p-table
            [value]="gruposPreguntasEstructura"
            [columns]="columnasGrupoPreguntaEstructura"
            [reorderableColumns]="true"
            [tableStyle]="{ 'min-width': '60rem' }"
            dataKey="id"
          >
            <ng-template pTemplate="header">
              <tr>
                <th style="width:3rem"></th>
                <th style="width:3rem"></th>
                <th *ngFor="let col of columnasGrupoPreguntaEstructura" pReorderableColumn>
                  {{ col.header }}
                </th>
              </tr>
            </ng-template>
            <ng-template
              pTemplate="body"
              let-grupoPreguntaEstructura
              let-expanded="expanded"
              let-index="rowIndex"
            >
              <tr [pReorderableRow]="index">
                <td>
                  <span class="pi pi-bars" pReorderableRowHandle></span>
                </td>
                <td>
                  <p-button
                    type="button" pRipple [pRowToggler]="grupoPreguntaEstructura"
                    [text]="true"
                    [rounded]="true"
                    [plain]="true"
                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"/>
                </td>
                <td>{{ grupoPreguntaEstructura.id }}</td>
                <td>{{ grupoPreguntaEstructura.nombre }}</td>
                <td>{{ grupoPreguntaEstructura.orden }}</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-product>
              <tr>
                <td colspan="7">
                  <div class="p-3">
                    <p-table [value]="product.orders" dataKey="id">
                      <ng-template pTemplate="header">
                        <tr>
                          <th pSortableColumn="id">Id
                            <p-sortIcon field="price"/>
                          </th>
                          <th pSortableColumn="customer">Customer
                            <p-sortIcon field="customer"/>
                          </th>
                          <th pSortableColumn="date">Date
                            <p-sortIcon field="date"/>
                          </th>
                          <th pSortableColumn="amount">Amount
                            <p-sortIcon field="amount"/>
                          </th>
                          <th pSortableColumn="status">Status
                            <p-sortIcon field="status"/>
                          </th>
                          <th style="width: 4rem"></th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-order>
                        <tr>
                          <td>{{ order.id }}</td>
                          <td>{{ order.customer }}</td>
                          <td>{{ order.date }}</td>
                          <td>{{ order.amount | currency : 'USD' }}</td>
                          <td>
                            <p-button type="button" icon="pi pi-search"/>
                          </td>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td colspan="6">There are no order for this product yet.</td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </p-tabPanel>

  </p-tabView>
</div>
